/*
 * steganography.js v1.0.1 2016-04-04
 *
 * Copyright (C) 2012 Peter Eigenschink (http://www.peter-eigenschink.at/)
 * Dual-licensed under MIT and Beerware license.
*/
!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("stego",this,function(){var a=function(){},b={isPrime:function(a){if(isNaN(a)||!isFinite(a)||a%1||2>a)return!1;if(a%2===0)return 2===a;if(a%3===0)return 3===a;for(var b=Math.sqrt(a),c=5;b>=c;c+=6){if(a%c===0)return!1;if(a%(c+2)===0)return!1}return!0},findNextPrime:function(a){for(var c=a;!0;c+=1)if(b.isPrime(c))return c},sum:function(a,b,c){var d=0;c=c||{};for(var e=c.start||0;b>e;e+=c.inc||1)d+=a(e)||0;return 0===d&&c.defValue?c.defValue:d},product:function(a,b,c){var d=1;c=c||{};for(var e=c.start||0;b>e;e+=c.inc||1)d*=a(e)||1;return 1===d&&c.defValue?c.defValue:d},createArrayFromArgs:function(a,b,c){for(var d=new Array(c-1),e=0;c>e;e+=1)d[e]=a(e>=b?e+1:e);return d}};return a.prototype.config={t:3,threshold:1,codeUnitSize:16,args:function(a){return a+1},messageDelimiter:function(a,b){for(var c=new Array(3*b),d=0;d<c.length;d+=1)c[d]=255;return c},messageCompleted:function(a,b,c){for(var d=!0,e=0;16>e&&d;e+=1)d=d&&255===a[b+4*e];return d}},a.prototype.getHidingCapacity=function(a,b){b=b||{};var c=this.config,d=b.width||a.width,e=b.height||a.height,f=b.t||c.t,g=b.codeUnitSize||c.codeUnitSize;return f*d*e/g>>0},a.prototype.encode=function(a,c,d){d=d||{};var e=this.config,f=document.createElement("canvas"),g=f.getContext("2d");if(f.style.display="none",c.length){var h=c;c=new Image,c.src=h}f.width=d.width||c.width,f.height=d.height||c.height,d.height&&d.width?g.drawImage(c,0,0,d.width,d.height):g.drawImage(c,0,0);var i,j,k,l,m,n,o,p,q,r,s=g.getImageData(0,0,f.width,f.height),t=s.data,u=d.t||e.t,v=d.threshold||e.threshold,w=d.codeUnitSize||e.codeUnitSize,x=w/u>>0,y=w%u,z=d.messageDelimiter||e.messageDelimiter,A=d.args||e.args,B=b.findNextPrime(Math.pow(2,u)),C=[];for(n=0;n<=a.length;n+=1){if(p=a.charCodeAt(n)||0,q=y*n%u,q>0&&j){if(r=Math.pow(2,u-q)-1,k=Math.pow(2,w)*(1-Math.pow(2,-q)),l=(p&r)<<q,m=(j&k)>>w-q,C.push(l+m),n<a.length){for(r=Math.pow(2,2*u-q)*(1-Math.pow(2,-u)),o=1;x>o;o+=1)i=p&r,C.push(i>>(o-1)*u+(u-q)),r<<=u;y*(n+1)%u===0?(r=Math.pow(2,w)*(1-Math.pow(2,-u)),i=p&r,C.push(i>>w-u)):u>=y*(n+1)%u+(u-q)&&(i=p&r,C.push(i>>(x-1)*u+(u-q)))}}else if(n<a.length)for(r=Math.pow(2,u)-1,o=0;x>o;o+=1)i=p&r,C.push(i>>o*u),r<<=u;j=p}var D,E,F,G,H,I=z(C,v);for(D=0;4*(D+v)<=t.length&&D+v<=C.length;D+=v){for(H=[],n=0;v>n&&n+D<C.length;n+=1){for(G=0,o=D;v+D>o&&o<C.length;o+=1)G+=C[o]*Math.pow(A(n),o-D);H[n]=255-B+1+G%B}for(n=4*D;n<4*(D+H.length)&&n<t.length;n+=4)t[n+3]=H[n/4%v];F=H.length}for(E=D+F;E-(D+F)<I.length&&4*(D+I.length)<t.length;E+=1)t[4*E+3]=I[E-(D+F)];for(n=4*(E+1)+3;n<t.length;n+=4)t[n]=255;return s.data=t,g.putImageData(s,0,0),f.toDataURL()},a.prototype.decode=function(a,c){c=c||{};var d,e,f=this.config,g=c.t||f.t,h=c.threshold||f.threshold,i=c.codeUnitSize||f.codeUnitSize,j=b.findNextPrime(Math.pow(2,g)),k=(c.args||f.args,[]),l=c.messageCompleted||f.messageCompleted;if(!g||1>g&&g>7)throw"Error: Parameter t = "+g+" is not valid: 0 < t < 8";var m=document.createElement("canvas"),n=m.getContext("2d");if(m.style.display="none",document.body.appendChild(m),a.length){var o=a;a=new Image,a.src=o}m.width=c.width||a.width,m.height=c.width||a.height,c.height&&c.width?n.drawImage(a,0,0,c.width,c.height):n.drawImage(a,0,0),d=n.getImageData(0,0,m.width,m.height),e=d.data;var p,q;if(1===h)for(p=3,q=!1;!q&&p<e.length&&!q;p+=4)q=l(e,p,h),q||k.push(e[p]-(255-j+1));var r="",s=0,t=0,u=Math.pow(2,i)-1;for(p=0;p<k.length;p+=1)s+=k[p]<<t,t+=g,t>=i&&(r+=String.fromCharCode(s&u),t%=i,s=k[p]>>g-t);return 0!==s&&(r+=String.fromCharCode(s&u)),r},new a});