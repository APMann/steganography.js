/*
 * steganography.js v1.0.2 2016-04-08
 *
 * Copyright (C) 2012 Peter Eigenschink (http://www.peter-eigenschink.at/)
 * Dual-licensed under MIT and Beerware license.
*/
!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("steg",this,function(){var a=function(){},b={isPrime:function(a){if(isNaN(a)||!isFinite(a)||a%1||2>a)return!1;if(a%2===0)return 2===a;if(a%3===0)return 3===a;for(var b=Math.sqrt(a),c=5;b>=c;c+=6){if(a%c===0)return!1;if(a%(c+2)===0)return!1}return!0},findNextPrime:function(a){for(var c=a;!0;c+=1)if(b.isPrime(c))return c},sum:function(a,b,c){var d=0;c=c||{};for(var e=c.start||0;b>e;e+=c.inc||1)d+=a(e)||0;return 0===d&&c.defValue?c.defValue:d},product:function(a,b,c){var d=1;c=c||{};for(var e=c.start||0;b>e;e+=c.inc||1)d*=a(e)||1;return 1===d&&c.defValue?c.defValue:d},createArrayFromArgs:function(a,b,c){for(var d=new Array(c-1),e=0;c>e;e+=1)d[e]=a(e>=b?e+1:e);return d}};return a.prototype.config={t:3,threshold:1,codeUnitSize:16,args:function(a){return a+1},messageDelimiter:function(a,b){for(var c=new Array(3*b),d=0;d<c.length;d+=1)c[d]=255;return c},messageCompleted:function(a,b,c){for(var d=!0,e=0;16>e&&d;e+=1)d=d&&255===a[b+4*e];return d}},a.prototype.getHidingCapacity=function(a,b){b=b||{};var c=this.config,d=b.width||a.width,e=b.height||a.height,f=b.t||c.t,g=b.codeUnitSize||c.codeUnitSize;return f*d*e/g>>0},a.prototype.encode=function(a,c,d){if(c.length){var e=c;c=new Image,c.src=e}d=d||{};var f=this.config,g=d.t||f.t,h=d.threshold||f.threshold,i=d.codeUnitSize||f.codeUnitSize,j=b.findNextPrime(Math.pow(2,g)),k=d.args||f.args,l=d.messageDelimiter||f.messageDelimiter;if(!g||1>g&&g>7)throw"Error: Parameter t = "+g+" is not valid: 0 < t < 8";var m=document.createElement("canvas"),n=m.getContext("2d");m.style.display="none",m.width=d.width||c.width,m.height=d.height||c.height,d.height&&d.width?n.drawImage(c,0,0,d.width,d.height):n.drawImage(c,0,0);var o,p,q,r,s,t,u,v,w,x,y=n.getImageData(0,0,m.width,m.height),z=y.data,A=i/g>>0,B=i%g,C=[];for(w=0;w<=a.length;w+=1){if(t=a.charCodeAt(w)||0,u=B*w%g,u>0&&p){if(v=Math.pow(2,g-u)-1,q=Math.pow(2,i)*(1-Math.pow(2,-u)),r=(t&v)<<u,s=(p&q)>>i-u,C.push(r+s),w<a.length){for(v=Math.pow(2,2*g-u)*(1-Math.pow(2,-g)),x=1;A>x;x+=1)o=t&v,C.push(o>>(x-1)*g+(g-u)),v<<=g;B*(w+1)%g===0?(v=Math.pow(2,i)*(1-Math.pow(2,-g)),o=t&v,C.push(o>>i-g)):g>=B*(w+1)%g+(g-u)&&(o=t&v,C.push(o>>(A-1)*g+(g-u)))}}else if(w<a.length)for(v=Math.pow(2,g)-1,x=0;A>x;x+=1)o=t&v,C.push(o>>x*g),v<<=g;p=t}var D,E,F,G,H,I=l(C,h);for(D=0;4*(D+h)<=z.length&&D+h<=C.length;D+=h){for(H=[],w=0;h>w&&w+D<C.length;w+=1){for(G=0,x=D;h+D>x&&x<C.length;x+=1)G+=C[x]*Math.pow(k(w),x-D);H[w]=255-j+1+G%j}for(w=4*D;w<4*(D+H.length)&&w<z.length;w+=4)z[w+3]=H[w/4%h];F=H.length}for(E=D+F;E-(D+F)<I.length&&4*(D+I.length)<z.length;E+=1)z[4*E+3]=I[E-(D+F)];for(w=4*(E+1)+3;w<z.length;w+=4)z[w]=255;return y.data=z,n.putImageData(y,0,0),m.toDataURL()},a.prototype.decode=function(a,c){if(a.length){var d=a;a=new Image,a.src=d}c=c||{};var e=this.config,f=c.t||e.t,g=c.threshold||e.threshold,h=c.codeUnitSize||e.codeUnitSize,i=b.findNextPrime(Math.pow(2,f)),j=(c.args||e.args,c.messageCompleted||e.messageCompleted);if(!f||1>f&&f>7)throw"Error: Parameter t = "+f+" is not valid: 0 < t < 8";var k=document.createElement("canvas"),l=k.getContext("2d");k.style.display="none",k.width=c.width||a.width,k.height=c.width||a.height,c.height&&c.width?l.drawImage(a,0,0,c.width,c.height):l.drawImage(a,0,0);var m,n,o=l.getImageData(0,0,k.width,k.height),p=o.data,q=[];if(1===g)for(m=3,n=!1;!n&&m<p.length&&!n;m+=4)n=j(p,m,g),n||q.push(p[m]-(255-i+1));var r="",s=0,t=0,u=Math.pow(2,h)-1;for(m=0;m<q.length;m+=1)s+=q[m]<<t,t+=f,t>=h&&(r+=String.fromCharCode(s&u),t%=h,s=q[m]>>f-t);return 0!==s&&(r+=String.fromCharCode(s&u)),r},new a});